<!DOCTYPE html>
<html lang="ko" data-color-scheme="dark">
<head>
  <meta charset="UTF-8" />
  <title>NICE MPC v44.3 Mobile Radar</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <style>
    /* íŠ¸ë ˆì´ë”ë‹˜ì´ ë§Œì¡±í•˜ì‹  ê·¸ ë””ìì¸ ê·¸ëŒ€ë¡œ ìœ ì§€ */
    :root {
      --color-background: #121418;
      --color-surface: #1a1d21;
      --color-primary: #00e5ff;
      --color-text: #e0e0e0;
      --color-text-muted: #8b949e;
      --border-color: rgba(255, 255, 255, 0.1);
      --radius-md: 12px;
      --font-mono: 'SF Mono', Menlo, monospace;
    }
    body {
      margin: 0; padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      background: var(--color-background); color: var(--color-text);
      -webkit-tap-highlight-color: transparent;
    }
    .container { max-width: 1200px; margin: 0 auto; padding: 16px; }
    
    /* PC: ì¢Œì¸¡ ì‚¬ì´ë“œë°”, ìš°ì¸¡ ë©”ì¸ / ëª¨ë°”ì¼: ì„¸ë¡œ ë°°ì¹˜ */
    .app-shell { display: grid; grid-template-columns: 280px 1fr; gap: 20px; margin-top: 20px; }
    @media (max-width: 900px) { .app-shell { grid-template-columns: 1fr; } }

    .card { background: var(--color-surface); border-radius: var(--radius-md); padding: 20px; border: 1px solid var(--border-color); }
    .mono { font-family: var(--font-mono); }
    .muted { color: var(--color-text-muted); }
    .flex-between { display: flex; justify-content: space-between; align-items: center; }
    
    /* í—¤ë” */
    header { display: flex; justify-content: space-between; align-items: center; }
    h1 { margin: 0; font-size: 24px; background: linear-gradient(90deg, var(--color-primary), #fff); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    .status-badge { padding: 4px 10px; border-radius: 20px; font-size: 12px; border: 1px solid var(--color-primary); color: var(--color-primary); background: rgba(0, 229, 255, 0.1); }

    /* NICE ë ˆì´ì–´ ë¦¬ìŠ¤íŠ¸ (ë””ìì¸ ìœ ì§€ + ì„¤ëª… ì¶”ê°€) */
    .layer-item { padding: 12px; border-radius: 8px; margin-bottom: 8px; background: rgba(255,255,255,0.03); display: flex; justify-content: space-between; align-items: center; }
    .layer-left { display: flex; flex-direction: column; }
    .layer-name { font-weight: bold; font-size: 14px; margin-bottom: 2px; display: flex; align-items: center; }
    .layer-dot { width: 8px; height: 8px; background: #22c55e; border-radius: 50%; margin-right: 8px; }
    .layer-desc { font-size: 11px; color: var(--color-primary); } /* ê°€ê²© ì •ë³´ê°€ ëœ° ê³³ */
    .layer-score { font-size: 16px; font-weight: bold; }

    /* ê²Œì´ì§€ */
    .infographic-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px; }
    @media (max-width: 768px) { .infographic-grid { grid-template-columns: 1fr; } }
    .wrs-score-big { font-size: 48px; font-weight: 800; color: var(--color-primary); }
    .gauge-bar-bg { height: 12px; background: #333; border-radius: 6px; margin: 16px 0; position: relative; overflow: hidden; }
    .gauge-marker { position: absolute; top: 0; width: 4px; height: 100%; background: #fff; box-shadow: 0 0 10px #fff; transition: left 0.5s; }

    /* ì¶”ì²œ ê·¸ë¦¬ë“œ */
    .recommendation-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; margin-top: 16px; }
    @media (max-width: 1024px) { .recommendation-grid { grid-template-columns: repeat(2, 1fr); } }
    @media (max-width: 600px) { .recommendation-grid { grid-template-columns: 1fr; } }

    .reco-item { background: rgba(0,0,0,0.2); padding: 12px; border-radius: 8px; border: 1px solid var(--border-color); display: flex; flex-direction: column; gap: 8px; }
    .coin-header { display: flex; justify-content: space-between; align-items: center; }
    .role-tag { font-size: 10px; padding: 2px 6px; background: rgba(34, 197, 94, 0.2); color: #4ade80; border-radius: 4px; }
    .price-info { display: flex; justify-content: space-between; font-size: 13px; margin-top: 4px; border-top: 1px solid var(--border-color); padding-top: 8px; }
    .price-val { color: var(--color-primary); font-weight: bold; }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div>
        <h1>NICE MPC v44.3 ğŸš€</h1>
        <div class="muted" style="font-size:12px;">ëª¨ë°”ì¼ ìµœì í™” ì‹¤ì‹œê°„ ë ˆì´ë”</div>
      </div>
      <div class="status-badge">â— LIVE SYSTEM</div>
    </header>

    <div class="app-shell">
      <aside class="card">
        <div class="flex-between" style="margin-bottom:16px;">
            <span class="muted" style="font-size:13px;">NICE ë ˆì´ì–´ ì ìˆ˜</span>
            <span class="mono" style="font-size:12px;" id="last-update">--:--</span>
        </div>
        <div id="layer-list"></div> <div style="margin-top:20px; padding-top:16px; border-top:1px solid var(--border-color);">
             <div class="flex-between"><span class="muted">WRS ì¢…í•©</span><span class="mono font-bold" style="font-size:20px;" id="side-wrs">--.--</span></div>
             <div class="flex-between" style="margin-top:8px;"><span class="muted">TIER íŒì •</span><span class="status-badge" id="side-tier">ë¶„ì„ì¤‘</span></div>
        </div>
      </aside>

      <main>
        <section class="card">
           <div class="flex-between">
               <h2 style="margin:0; font-size:18px;">ì‹¤ì‹œê°„ ì‹œì¥ ê°•ë„ (WRS)</h2>
               <button onclick="fetchData()" style="background:transparent; border:1px solid var(--color-primary); color:var(--color-primary); padding:4px 12px; border-radius:4px; cursor:pointer;">ìƒˆë¡œê³ ì¹¨</button>
           </div>
           <div class="infographic-grid">
               <div style="text-align:center;">
                   <div class="muted" style="font-size:12px;">í˜„ì¬ í†µí•© ì ìˆ˜</div>
                   <div class="wrs-score-big mono"><span id="main-wrs">--.--</span><span style="font-size:20px;color:var(--color-text-muted)">/100</span></div>
                   <div class="gauge-bar-bg">
                       <div style="height:100%; width:100%; background: linear-gradient(90deg, #ef4444, #eab308, #22c55e);"></div>
                       <div class="gauge-marker" id="gauge-marker" style="left: 0%;"></div>
                   </div>
               </div>
               <div>
                   <div class="muted" style="font-size:12px; margin-bottom:8px;">ìµœê·¼ íë¦„</div>
                   <div id="timeline-box" style="display:flex; gap:8px; overflow-x:auto;">
                       </div>
               </div>
           </div>
        </section>

        <section class="card" style="margin-top:20px;">
            <div class="flex-between" style="margin-bottom:12px;">
                <h2 style="margin:0; font-size:18px;">NICE ì¶”ì²œ í¬íŠ¸í´ë¦¬ì˜¤</h2>
            </div>
            <div class="recommendation-grid" id="reco-grid">
                </div>
        </section>
      </main>
    </div>
  </div>

  <script>
    async function fetchData() {
        try {
            const res = await fetch('/api/mpc-data');
            const data = await res.json();
            updateDashboard(data);
        } catch (e) {
            console.error("ì—°ê²° ì‹¤íŒ¨", e);
        }
    }

    function updateDashboard(data) {
        const current = data.current_snapshot;
        
        // 1. ê¸°ë³¸ ì •ë³´
        document.getElementById('last-update').textContent = current.time.slice(11); // ì‹œê°„ë§Œ í‘œì‹œ
        document.getElementById('side-wrs').textContent = current.wrs;
        document.getElementById('side-tier').textContent = current.tier;
        document.getElementById('main-wrs').textContent = current.wrs;
        
        // ê²Œì´ì§€ ìœ„ì¹˜ (0~100%)
        document.getElementById('gauge-marker').style.left = `${Math.min(data.current_snapshot.wrs, 100)}%`;

        // 2. NICE ë ˆì´ì–´ (ë””ìì¸ ìœ ì§€ + ê°€ê²© ì •ë³´ l.desc ì¶”ê°€)
        const layerList = document.getElementById('layer-list');
        layerList.innerHTML = '';
        data.layer_scores.forEach(l => {
            layerList.innerHTML += `
            <div class="layer-item">
                <div class="layer-left">
                    <div class="layer-name"><span class="layer-dot"></span>${l.name}</div>
                    <div class="layer-desc">${l.desc}</div> </div>
                <div class="layer-score mono">${l.score}ì </div>
            </div>`;
        });

        // 3. ì¶”ì²œ ì¹´ë“œ (ì—¬ê¸°ì— ê°€ê²© ì •ë³´ c.entry ë„£ìŒ)
        const grid = document.getElementById('reco-grid');
        grid.innerHTML = '';
        
        ['scalping', 'short', 'medium'].forEach(cat => {
            const group = data.recommendations[cat];
            if(!group || !group.coins) return;

            group.coins.forEach(c => {
                grid.innerHTML += `
                <div class="reco-item">
                    <div class="coin-header">
                        <span style="font-weight:bold;">${c.symbol}</span>
                        <span class="role-tag">${group.mode}</span>
                    </div>
                    <div style="font-size:12px; color:#8b949e;">${c.label}</div>
                    <div class="price-info mono">
                        <span>ì§„ì… <span class="price-val">${c.entry}</span></span> <span>ëª©í‘œ <span style="color:#eab308;">${c.tp}</span></span>
                    </div>
                </div>`;
            });
        });
    }

    // ì´ˆê¸° ì‹¤í–‰ ë° 3ì´ˆ ë°˜ë³µ
    fetchData();
    setInterval(fetchData, 3000);
  </script>
</body>
</html>